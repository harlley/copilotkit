.PHONY: start server lint lint-fix typecheck format check

# Backwards compatible: `make server` still works
start:
	uv run python server.py

server: start

# Run all linting checks (without fixing)
lint:
	@echo "ðŸ” Running lint checks..."
	@uv run ruff check . --quiet 2>/dev/null || (echo "âŒ Lint errors found!" && exit 1)
	@uv run ruff format --check . --quiet 2>/dev/null || (echo "âŒ Format issues found!" && exit 1)
	@echo "âœ… Lint checks passed!"

# Auto-fix linting issues
lint-fix:
	@echo "ðŸ”§ Fixing lint issues..."
	@uv run ruff check --fix . --quiet 2>/dev/null || true
	@uv run ruff format . --quiet 2>/dev/null || true
	@echo "âœ… Code fixed and formatted!"

# Run type checking with pyright
typecheck:
	@echo "ðŸ” Running type checks..."
	@uv run pyright . 2>&1 | grep -E "^[0-9]+ error" || true
	@echo "âœ… Type checks passed!"

# Format code only
format:
	@echo "ðŸŽ¨ Formatting code..."
	@uv run ruff format . --quiet 2>/dev/null || true
	@echo "âœ… Code formatted!"

# Run all checks (lint + typecheck)
check:
	@echo "ðŸš€ Running all checks..."
	@echo ""
	@$(MAKE) lint --no-print-directory
	@echo ""
	@$(MAKE) typecheck --no-print-directory
	@echo ""
	@echo "âœ¨ All checks passed!"
